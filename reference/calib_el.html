<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="calib_el performs calibration using empirical likelihood (EL) method. The function is taken from Wu (2005). If algorithm has problem with convergence constrOptim is used instead (as in Zhang, Han and Wu (2022)).
In (pseudo) EL the following (pseudo) EL function is maximized
\[\sum_{i \in r} d_i\log(p_i),\]
under the following constraint
\[\sum_{i \in r} p_i = 1,\]
with constraints on quantiles (with notation as in Harms and Duchesne (2006))
\[\sum_{i \in r} p_i(a_{i} - \alpha/N) = 0,\]
where \(a_{i}\) is created using joint_calib_create_matrix function, and possibly means
\[\sum_{i \in r} p_i(x_{i} - \mu_{x}) = 0,\]
where \(\mu_{x}\) is known population mean of X. For simplicity of notation we assume only one quantile and one mean is known. This can be generalized to multiple quantiles and means."><title>An internal function for calibration of weights using empirical likelihood method — calib_el • jointCalib</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An internal function for calibration of weights using empirical likelihood method — calib_el"><meta property="og:description" content="calib_el performs calibration using empirical likelihood (EL) method. The function is taken from Wu (2005). If algorithm has problem with convergence constrOptim is used instead (as in Zhang, Han and Wu (2022)).
In (pseudo) EL the following (pseudo) EL function is maximized
\[\sum_{i \in r} d_i\log(p_i),\]
under the following constraint
\[\sum_{i \in r} p_i = 1,\]
with constraints on quantiles (with notation as in Harms and Duchesne (2006))
\[\sum_{i \in r} p_i(a_{i} - \alpha/N) = 0,\]
where \(a_{i}\) is created using joint_calib_create_matrix function, and possibly means
\[\sum_{i \in r} p_i(x_{i} - \mu_{x}) = 0,\]
where \(\mu_{x}\) is known population mean of X. For simplicity of notation we assume only one quantile and one mean is known. This can be generalized to multiple quantiles and means."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">jointCalib</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a_theory.html">Joint calibration estimators for totals and quantiles</a>
    <a class="dropdown-item" href="../articles/b_survey.html">Calibration of quantiles and a joint calibration of totals and quanitles for surveys</a>
    <a class="dropdown-item" href="../articles/c_nonprob.html">Calibration and inverse probability weighting for non-probability samples</a>
    <a class="dropdown-item" href="../articles/d_causal.html">Balancing distributions for observational studies</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ncn-foreigners/jointCalib/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>An internal function for calibration of weights using empirical likelihood method</h1>
      <small class="dont-index">Source: <a href="https://github.com/ncn-foreigners/jointCalib/blob/HEAD/R/calib_el.R" class="external-link"><code>R/calib_el.R</code></a></small>
      <div class="d-none name"><code>calib_el.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>calib_el</code> performs calibration using empirical likelihood (EL) method. The function is taken from Wu (2005). If algorithm has problem with convergence <code>constrOptim</code> is used instead (as in Zhang, Han and Wu (2022)).</p>
<p>In (pseudo) EL the following (pseudo) EL function is maximized</p>
<p>\[\sum_{i \in r} d_i\log(p_i),\]</p>
<p>under the following constraint</p>
<p>\[\sum_{i \in r} p_i = 1,\]</p>
<p>with constraints on quantiles (with notation as in Harms and Duchesne (2006))</p>
<p>\[\sum_{i \in r} p_i(a_{i} - \alpha/N) = 0,\]</p>
<p>where <em></em>\(a_{i}\) is created using <code>joint_calib_create_matrix</code> function, and possibly means</p>
<p>\[\sum_{i \in r} p_i(x_{i} - \mu_{x}) = 0,\]</p>
<p>where <em></em>\(\mu_{x}\) is known population mean of X. For simplicity of notation we assume only one quantile and one mean is known. This can be generalized to multiple quantiles and means.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calib_el</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">d</span>,</span>
<span>  <span class="va">totals</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-08</span>,</span>
<span>  eps <span class="op">=</span> <span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>,</span>
<span>  att <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>X</dt>
<dd><p>matrix of variables for calibration of quantiles and totals (first column should be intercept),</p></dd>


<dt>d</dt>
<dd><p>initial d-weights for calibration (e.g. design-weights),</p></dd>


<dt>totals</dt>
<dd><p>vector of totals (where 1 element is the population size),</p></dd>


<dt>maxit</dt>
<dd><p>a numeric value giving the maximum number of iterations,</p></dd>


<dt>tol</dt>
<dd><p>the desired accuracy for the iterative procedure,</p></dd>


<dt>eps</dt>
<dd><p>the desired accuracy for computing the Moore-Penrose generalized inverse (see <code><a href="https://rdrr.io/pkg/MASS/man/ginv.html" class="external-link">MASS::ginv()</a></code>),</p></dd>


<dt>att</dt>
<dd><p>indicating whether the weights should sum up treatment group (for <code>joint_calib_att</code> function),</p></dd>


<dt>...</dt>
<dd><p>arguments passed to <a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim</a> via <a href="https://rdrr.io/r/stats/constrOptim.html" class="external-link">stats::constrOptim</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns a vector of empirical likelihood g-weights</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Wu, C. (2005). Algorithms and R codes for the pseudo empirical likelihood method in survey sampling. Survey Methodology, 31(2), 239 (code is taken from <a href="https://sas.uwaterloo.ca/~cbwu/Rcodes/LagrangeM2.txt" class="external-link">https://sas.uwaterloo.ca/~cbwu/Rcodes/LagrangeM2.txt</a>).</p>
<p>Zhang, S., Han, P., and Wu, C. (2023) Calibration Techniques Encompassing Survey Sampling, Missing Data Analysis and Causal Inference. International Statistical Review, 91: 165–192. https://doi.org/10.1111/insr.12518 (code is taken from Supplementary Materials).</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Maciej Beręsewicz based on Wu (2005) and Zhang, Han and Wu (2022)</p>
<p><script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## generate data based on Haziza and Lesage (2016)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">80</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">*</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span> <span class="op">-</span> <span class="fl">0.014</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">totals_known</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>N<span class="op">=</span><span class="va">N</span>, x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">p</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df_resp</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">p</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">df_resp</span><span class="op">$</span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">N</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_resp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">calib_el</span><span class="op">(</span>X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span>, <span class="va">df_resp</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                d <span class="op">=</span> <span class="va">df_resp</span><span class="op">$</span><span class="va">d</span>,</span></span>
<span class="r-in"><span>                totals <span class="op">=</span> <span class="va">totals_known</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>known <span class="op">=</span> <span class="va">totals_known</span>, estimated<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">res</span><span class="op">*</span><span class="va">df_resp</span><span class="op">$</span><span class="va">d</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">x</span>, <span class="va">df_resp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      known estimated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N  1000.00   1000.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x 39782.22  39782.22</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Maciej Beręsewicz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

